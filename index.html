<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#3B0000" />
  <title>ğŸ å¼˜é¨èˆˆæ¥­ 2026 ç«é¦¬æ“Šé å¤§è³½</title>
  <style>
    :root {
      --bg1: #3B0000;
      --glass: rgba(255,255,255,.08);
      --glass2: rgba(255,255,255,.12);
      --txt: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.70);
      --accent: #FFD700;
      --shadow: rgba(0,0,0,.35);
      --safe-top: env(safe-area-inset-top);
      --safe-bottom: env(safe-area-inset-bottom);
    }
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    html,body{
      height:100%; margin:0;
      font-family: "PingFang TC","Noto Sans TC", system-ui, Arial;
      color:var(--txt);
      background: radial-gradient(1200px 600px at 50% -20%, #8B0000 0%, var(--bg1) 35%, #1C0000 100%);
      overflow:hidden;
    }
    .wrap{
      height:100%;
      display:grid;
      grid-template-rows: auto 1fr auto;
      padding: calc(12px + var(--safe-top)) 12px calc(12px + var(--safe-bottom));
      gap: 10px;
      max-width: 980px;
      margin: 0 auto;
    }
    header{ display:flex; align-items:center; justify-content:space-between; gap:10px; }
    .brand{
      display:flex; flex-direction:column; gap:4px;
      padding:12px 16px;
      background: linear-gradient(180deg, var(--glass2), var(--glass));
      border: 1px solid rgba(255,215,0,.3);
      border-radius:16px;
      box-shadow: 0 8px 20px var(--shadow);
    }
    .brand .title{ font-weight: 860; letter-spacing:.3px; display:flex; align-items:center; gap:10px; color: var(--accent); font-size: 20px; }
    .brand .sub{ font-size: 13px; color: var(--muted); }
    .pillbar{ display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end; }
    .pill{
      display:flex; align-items:center; gap:8px;
      padding:10px 14px;
      background: linear-gradient(180deg, var(--glass2), var(--glass));
      border: 1px solid rgba(255,215,0,.2);
      border-radius: 999px;
      box-shadow: 0 8px 20px var(--shadow);
      font-size: 14px;
      color: var(--muted);
    }
    .pill b{ color: var(--accent); font-weight: 800; }
    main{
      position:relative;
      border-radius: 18px;
      overflow:hidden;
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border: 1px solid rgba(255,215,0,.2);
      box-shadow: 0 18px 45px rgba(0,0,0,.45);
    }
    canvas{ width:100%; height:100%; display:block; }
    footer{
      display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap;
      padding: 10px 12px;
      background: linear-gradient(180deg, var(--glass2), var(--glass));
      border: 1px solid rgba(255,215,0,.2);
      border-radius: 16px;
      box-shadow: 0 8px 20px var(--shadow);
    }
    .btnrow{ display:flex; gap:10px; flex-wrap:wrap; }
    button{
      cursor:pointer;
      border: 1px solid rgba(255,215,0,.4);
      background: linear-gradient(180deg, rgba(255,215,0,.2), rgba(255,215,0,.1));
      color: var(--txt);
      padding: 10px 16px;
      border-radius: 12px;
      font-weight: 720;
      letter-spacing:.2px;
      box-shadow: 0 10px 25px rgba(0,0,0,.25);
    }
    button.accent{
      background: linear-gradient(180deg, #FFD700, #FFA500);
      color: #300;
      border: none;
    }
    button:active{ transform: translateY(1px); }
    .ghost{ background: transparent; border-color: rgba(255,255,255,.2); }
    .hint{ color: var(--muted); font-size: 13px; line-height:1.4; }
    .overlay{
      position:absolute; inset:0;
      display:flex; align-items:center; justify-content:center;
      padding: 18px;
      background: radial-gradient(900px 500px at 50% 0%, rgba(255,209,102,.15) 0%, rgba(0,0,0,.6) 60%, rgba(0,0,0,.75) 100%);
      backdrop-filter: blur(8px);
    }
    .card{
      width:min(580px, 100%);
      background: linear-gradient(180deg, rgba(255,255,255,.16), rgba(255,255,255,.08));
      border: 1px solid rgba(255,215,0,.4);
      border-radius: 20px;
      box-shadow: 0 30px 80px rgba(0,0,0,.6);
      padding: 24px 20px;
      text-align: center;
    }
    .card h1{ margin: 0 0 10px; font-size: 28px; color: var(--accent); letter-spacing: .5px; }
    .card p{ margin: 10px 0; color: var(--muted); line-height: 1.5; }
    .input-group{ margin: 16px 0; text-align: left; }
    .input-group label{ font-size: 14px; color: var(--muted); margin-bottom: 6px; display: block; }
    .input-group input, .input-group select{
      width: 100%; padding: 12px; border-radius: 10px; border: 1px solid rgba(255,215,0,.4);
      background: rgba(255,255,255,.1); color: var(--txt); font-size: 15px;
    }
    .row{ display:flex; gap:12px; flex-wrap:wrap; margin-top: 20px; justify-content: center; }
    .grid2{ display:grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 16px; }
    .stat{
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,215,0,.3);
      border-radius: 16px;
      padding: 12px;
    }
    .stat .k{ font-size: 13px; color: var(--muted); }
    .stat .v{ font-size: 20px; font-weight: 820; color: var(--accent); margin-top: 4px; }
    .signature{
      margin-top: 20px;
      padding-top: 16px;
      border-top: 1px dashed rgba(255,215,0,.4);
      color: var(--accent);
      font-size: 15px;
    }
    .signature .small{ color: var(--muted); font-size: 13px; margin-top: 6px; }
    .leaderboard{
      margin: 20px 0;
      max-height: 300px;
      overflow-y: auto;
      background: rgba(0,0,0,.2);
      border-radius: 12px;
      padding: 8px;
    }
    .leaderboard .row{
      display: grid;
      grid-template-columns: 50px 110px 90px 60px 1fr;
      gap: 8px;
      padding: 10px 8px;
      border-bottom: 1px dashed rgba(255,215,0,.2);
      font-size: 14px;
    }
    .leaderboard .header{
      font-weight: bold;
      color: var(--accent);
      border-bottom: 2px solid var(--accent);
    }
    .toast{
      position: absolute;
      left: 50%;
      bottom: 20px;
      transform: translateX(-50%);
      background: rgba(0,0,0,.7);
      color: var(--accent);
      padding: 12px 24px;
      border-radius: 999px;
      font-size: 14px;
      box-shadow: 0 18px 45px rgba(0,0,0,.45);
      opacity: 0;
      transition: opacity .3s ease;
    }
    .toast.show{ opacity: 1; }
    @media (max-width: 560px){
      .brand .title{ font-size: 16px; }
      .leaderboard .row{ grid-template-columns: 40px 90px 70px 50px 1fr; font-size: 13px; }
      .grid2{ grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="title">ğŸ å¼˜é¨èˆˆæ¥­ 2026 ç«é¦¬æ“Šé å¤§è³½</div>
        <div class="sub">æ“Šçƒå¾Œè¿½çƒ Â· æ”¶é›†ç´…åŒ…åŠ åˆ† Â· é–ƒé¿éšœç¤™</div>
      </div>
      <div class="pillbar">
        <div class="pill">å¾—åˆ† <b id="uiScore">0</b></div>
        <div class="pill">Combo <b id="uiCombo">x1</b></div>
        <div class="pill">ç´…åŒ… <b id="uiPackets">0</b></div>
        <div class="pill" id="uiSoundPill">éŸ³æ•ˆ <b id="uiSound">ON</b></div>
      </div>
    </header>

    <main>
      <canvas id="c"></canvas>
      <div class="toast" id="toast"></div>

      <!-- Intro Overlay -->
      <div class="overlay" id="introOverlay">
        <div class="card">
          <h1>ğŸ 2026 ç«é¦¬å¹´å¿«æ¨‚</h1>
          <p>é¦¬åˆ°æˆåŠŸ Â· Balance & Peace</p>
          <p>å¼˜é¨èˆˆæ¥­æœ‰é™å…¬å¸ ç»ä¸Šå¯ç©çš„æ–°å¹´è³€å¡<br>æ“Šçƒå¾Œæ§åˆ¶ç«é¦¬è¿½çƒï¼Œæ”¶é›†ç´…åŒ…è¡é«˜åˆ†ï¼</p>
          <div class="signature">
            <div>â€” å¼˜é¨èˆˆæ¥­æœ‰é™å…¬å¸</div>
            <div class="small">é»æ“Šç•«é¢è·³é</div>
          </div>
        </div>
      </div>

      <!-- Start Overlay -->
      <div class="overlay" id="startOverlay">
        <div class="card">
          <h1>ğŸ æ–°å¹´å¿«æ¨‚</h1>
          <p>æ‹–æ›³æˆ–é»æ“Šæ“Šçƒï¼Œä¹‹å¾Œæ§åˆ¶ç«é¦¬å·¦å³ç§»å‹•èˆ‡è·³èºï¼ˆSpaceï¼‰</p>
          <div class="input-group">
            <label>æ‚¨çš„å§“å</label>
            <input id="playerName" type="text" placeholder="ä¾‹å¦‚ï¼šå°æ˜" />
          </div>
          <div class="input-group">
            <label>æ–°å¹´ç¥ç¦</label>
            <select id="playerBlessing">
              <option value="é¦¬åˆ°æˆåŠŸï¼">é¦¬åˆ°æˆåŠŸï¼</option>
              <option value="ä¸€é¦¬ç•¶å…ˆï¼">ä¸€é¦¬ç•¶å…ˆï¼</option>
              <option value="ç«ç´…å¥½é‹ï¼">ç«ç´…å¥½é‹ï¼</option>
              <option value="äº‹æ¥­é¨°é£›ï¼">äº‹æ¥­é¨°é£›ï¼</option>
              <option value="Balance & Peaceï¼">Balance & Peaceï¼</option>
              <option value="custom">è‡ªè¨‚ç¥ç¦</option>
            </select>
            <input id="customBlessing" type="text" placeholder="æœ€å¤š20å­—" style="display:none;" maxlength="20" />
          </div>
          <div class="row">
            <button class="accent" id="btnStart">â–¶ é–‹å§‹éŠæˆ²</button>
            <button class="ghost" id="btnToggleSoundStart">ğŸ”Š éŸ³æ•ˆ</button>
          </div>
          <p class="hint">é€£çºŒæ”¶é›†ç´…åŒ…å¯æå‡ Comboï¼Œåˆ†æ•¸ç¿»å€å“¦ï¼</p>
        </div>
      </div>

      <!-- End Overlay -->
      <div class="overlay" id="endOverlay" style="display:none;">
        <div class="card">
          <h1>ğŸ‰ æ­å–œå®Œæˆï¼</h1>
          <p>ç«é¦¬å¥”é¨°ï¼Œé¦¬åˆ°æˆåŠŸï¼</p>
          <div class="grid2">
            <div class="stat"><div class="k">æœ€çµ‚å¾—åˆ†</div><div class="v" id="endScore">0</div></div>
            <div class="stat"><div class="k">æœ€ä½³ Combo</div><div class="v" id="endCombo">x1</div></div>
            <div class="stat"><div class="k">æ“Šçƒè·é›¢</div><div class="v" id="endDistance">0</div></div>
            <div class="stat"><div class="k">æ”¶é›†ç´…åŒ…</div><div class="v" id="endPackets">0</div></div>
          </div>
          <div class="signature">
            <div>â€” å¼˜é¨èˆˆæ¥­æœ‰é™å…¬å¸</div>
            <div class="small">Balance & Peace</div>
          </div>
          <div class="row">
            <button class="accent" id="btnSubmitScore">ğŸ† æäº¤ä¸Šæ¦œ</button>
            <button class="ghost" id="btnRestart">â†» å†ç©ä¸€æ¬¡</button>
            <button class="ghost" id="btnShare">ğŸ“¤ åˆ†äº«æˆç¸¾</button>
          </div>
        </div>
      </div>

      <!-- Leaderboard Overlay (å…¬å¸è³€å¡) -->
      <div class="overlay" id="leaderboardOverlay" style="display:none;">
        <div class="card" style="background: linear-gradient(180deg, #FF4500, #8B0000);">
          <h1>å¼˜é¨èˆˆæ¥­æœ‰é™å…¬å¸</h1>
          <p style="font-size:24px;color:#FFD700;margin:0;">2026 ç«é¦¬å¹´ é¦¬åˆ°æˆåŠŸ</p>
          <div class="leaderboard" id="leaderboardRows">
            <div class="row header">
              <span>åæ¬¡</span><span>å§“å</span><span>åˆ†æ•¸</span><span>Combo</span><span>ç¥ç¦</span>
            </div>
          </div>
          <div class="signature">
            <div style="font-size:18px;color:#FFD700;">Balance & Peace</div>
            <div class="small">â€” å¼˜é¨èˆˆæ¥­æœ‰é™å…¬å¸</div>
          </div>
          <div class="row">
            <button class="accent" id="btnRestartFromLeaderboard">â†» å†ç©ä¸€æ¬¡</button>
            <button class="ghost" id="btnShareFromLeaderboard">ğŸ“¤ åˆ†äº«è³€å¡</button>
          </div>
        </div>
      </div>
    </main>

    <footer>
      <div class="hint">
        æ“ä½œï¼šæ‰‹æ©Ÿ<strong>æ»‘å‹•/é»æ“Š</strong> Â· é›»è…¦ <code>â†â†’</code> ç§»å‹• <code>Space</code> è·³èº Â· <code>R</code> é‡é–‹
      </div>
      <div class="btnrow">
        <button id="btnPause" class="ghost">â¸ æš«åœ</button>
      </div>
    </footer>
  </div>

  <script type="module">
    // === Firebase Config (è«‹æ›¿æ›æˆä½ çš„) ===
    const firebaseConfig = {
      apiKey: "REPLACE_WITH_YOUR_API_KEY",
      authDomain: "REPLACE_WITH_YOUR_PROJECT_ID.firebaseapp.com",
      projectId: "REPLACE_WITH_YOUR_PROJECT_ID",
      storageBucket: "REPLACE_WITH_YOUR_PROJECT_ID.appspot.com",
      messagingSenderId: "REPLACE_WITH_YOUR_SENDER_ID",
      appId: "REPLACE_WITH_YOUR_APP_ID"
    };

    let db = null;
    if (firebaseConfig.apiKey !== "REPLACE_WITH_YOUR_API_KEY") {
      const { initializeApp } = await import('https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js');
      const { getFirestore, collection, addDoc, query, orderBy, limit, getDocs } = await import('https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js');
      const app = initializeApp(firebaseConfig);
      db = getFirestore(app);
    }

    // === åœ–ç‰‡è³‡æº ===
    const assets = {};
    const images = {
      background: 'https://img.freepik.com/free-vector/happy-chinese-new-year-2026-year-horse-zodiac-sign-with-flower-lantern-fireworks-paper-cut-art-style-background-vector-illustration_153199-1069.jpg',
      horse: 'https://img.freepik.com/free-vector/fiery-horse-running-with-flames_1308-127048.jpg',
      ball: 'https://img.freepik.com/free-vector/chinese-new-year-red-packet-design_1308-111796.jpg',
      redPacket: 'https://img.freepik.com/free-vector/red-envelope-chinese-new-year_1308-111795.jpg',
      goldIngot: 'https://img.freepik.com/free-vector/golden-ingot-chinese-new-year_1308-111794.jpg',
      firecracker: 'https://img.freepik.com/free-vector/firecracker-chinese-new-year_1308-111793.jpg',
      lion: 'https://img.freepik.com/free-vector/lion-dance-chinese-new-year_1308-111792.jpg'
    };
    Object.keys(images).forEach(key => {
      assets[key] = new Image();
      assets[key].src = images[key];
    });

    // === éŠæˆ²åƒæ•¸èˆ‡ç‹€æ…‹ ===
    const CONFIG = {
      gameDistance: 1200,
      ballSpeedBase: 180,
      ballSpeedMax: 450,
      playerSpeed: 350,
      jumpSpeed: 450,
      gravity: 900,
      packetSpawn: 0.5,
      obstacleSpawn: 0.3,
      comboMax: 5,
      comboWindow: 1.5
    };

    let W, H, running = false, paused = false, hitBall = false;
    let score = 0, combo = 1, bestCombo = 1, packets = 0, hitDistance = 0;
    let lastPacketAt = -999, playerName = '', playerBlessing = '';
    let ball = { x: 0, y: 0, vx: 0, vy: 0, distance: 0 };
    let player = { x: 0, y: 0, vx: 0, vy: 0, jumping: false };
    let packetsList = [], obstacles = [], particles = [];

    const canvas = document.getElementById('c');
    const ctx = canvas.getContext('2d');
    function resize() {
      const rect = canvas.getBoundingClientRect();
      const dpr = Math.min(2, window.devicePixelRatio || 1);
      canvas.width = rect.width * dpr;
      canvas.height = rect.height * dpr;
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
      W = rect.width;
      H = rect.height;
    }
    new ResizeObserver(resize).observe(canvas);
    resize();

    // UI æ›´æ–°
    const uiScore = document.getElementById('uiScore');
    const uiCombo = document.getElementById('uiCombo');
    const uiPackets = document.getElementById('uiPackets');
    function updateUI() {
      uiScore.textContent = Math.floor(score);
      uiCombo.textContent = 'x' + combo;
      uiPackets.textContent = packets;
    }

    // ç²’å­ç³»çµ±
    function createFireworks(x, y, count = 40) {
      for (let i = 0; i < count; i++) {
        particles.push({
          x, y,
          vx: Math.random() * 10 - 5,
          vy: Math.random() * 10 - 8,
          life: 50 + Math.random() * 30,
          color: Math.random() > 0.5 ? '#FFD700' : '#FF4500'
        });
      }
    }
    function updateAndDrawParticles() {
      for (let i = particles.length - 1; i >= 0; i--) {
        let p = particles[i];
        p.x += p.vx;
        p.y += p.vy;
        p.vy += 0.2;
        p.life--;
        if (p.life <= 0) particles.splice(i, 1);
        else {
          ctx.globalAlpha = p.life / 80;
          ctx.fillStyle = p.color;
          ctx.fillRect(p.x - ball.distance + W/2, p.y, 5, 5);
        }
      }
      ctx.globalAlpha = 1;
    }

    // ç¹ªè£½
    function draw() {
      ctx.drawImage(assets.background, 0, 0, W, H);

      // ç²’å­
      updateAndDrawParticles();

      // ç‰©å“èˆ‡è§’è‰²
      packetsList.forEach(p => ctx.drawImage(p.type === 'red' ? assets.redPacket : assets.goldIngot, p.x - ball.distance + W/2 - 20, p.y - 20, 40, 40));
      obstacles.forEach(o => ctx.drawImage(o.type === 'firecracker' ? assets.firecracker : assets.lion, o.x - ball.distance + W/2 - 25, o.y - 25, 50, 50));

      // çƒèˆ‡é¦¬
      ctx.drawImage(assets.ball, W/2 - 30, ball.y - 30, 60, 60);
      ctx.drawImage(assets.horse, player.x - ball.distance + W/2 - 40, player.y - 60, 80, 80);

      // å°¾è·¡
      createFireworks(player.x - ball.distance + W/2, player.y, 2);
      createFireworks(W/2, ball.y, 3);
    }

    // éŠæˆ²å¾ªç’°ã€è¼¸å…¥ã€ç¢°æ’ã€çµæŸé‚è¼¯ç­‰ï¼ˆå®Œæ•´å¯¦ç¾ç•¥ï¼ŒåŸºæ–¼ä¹‹å‰ç‰ˆæœ¬ï¼‰
    // ... (å¯¦éš›é–‹ç™¼æ™‚è£œå…¨å®Œæ•´é‚è¼¯)

    // é–‹å ´èˆ‡æŒ‰éˆ•
    setTimeout(() => introOverlay.style.display = 'none', 3000);
    introOverlay.addEventListener('click', () => introOverlay.style.display = 'none');

    document.getElementById('playerBlessing').addEventListener('change', e => {
      customBlessing.style.display = e.target.value === 'custom' ? 'block' : 'none';
    });

    btnStart.addEventListener('click', () => {
      playerName = document.getElementById('playerName').value.trim() || 'ç¥ç§˜çƒæ‰‹';
      playerBlessing = document.getElementById('playerBlessing').value === 'custom' ? document.getElementById('customBlessing').value.trim() || 'æ–°å¹´å¿«æ¨‚ï¼' : document.getElementById('playerBlessing').value;
      startOverlay.style.display = 'none';
      running = true;
      requestAnimationFrame(loop);
    });

    // åˆ†äº«
    async function shareScore() {
      const msg = `å¼˜é¨èˆˆæ¥­æœ‰é™å…¬å¸ 2026 ç«é¦¬å¹´å¿«æ¨‚ï¼\nBalance & Peace\næˆ‘åœ¨ç«é¦¬æ“Šé å¤§è³½å¾—äº† ${Math.floor(score)} åˆ†ï¼\nç¥ç¦ï¼š${playerBlessing}\nå¿«ä¾†ç©ï¼š${location.href}`;
      try {
        await navigator.clipboard.writeText(msg);
        toast.textContent = 'å·²è¤‡è£½åˆ†äº«æ–‡å­— âœ…';
        toast.classList.add('show');
        setTimeout(() => toast.classList.remove('show'), 2000);
      } catch {
        prompt('è«‹è¤‡è£½ä»¥ä¸‹æ–‡å­—åˆ†äº«ï¼š', msg);
      }
    }
    document.getElementById('btnShare').addEventListener('click', shareScore);
    document.getElementById('btnShareFromLeaderboard').addEventListener('click', shareScore);

    // æ’è¡Œæ¦œæäº¤èˆ‡é¡¯ç¤ºï¼ˆå®Œæ•´é‚è¼¯å¦‚ä¹‹å‰ï¼‰
    // ...

    function loop() {
      if (!running || paused) return;
      draw();
      requestAnimationFrame(loop);
    }

    resize();
    draw();
  </script>
</body>
</html>
