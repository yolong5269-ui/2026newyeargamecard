<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#3B0000" />
  <title>ğŸ Fire Horse Golf Dash 2026</title>
  <style>
    :root {
      --bg1: #3B0000;
      --glass: rgba(255,255,255,.08);
      --glass2: rgba(255,255,255,.12);
      --txt: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.70);
      --accent: #FFD700;
      --shadow: rgba(0,0,0,.35);
      --safe-top: env(safe-area-inset-top);
      --safe-bottom: env(safe-area-inset-bottom);
    }
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    html, body {
      height: 100%; margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, "PingFang TC","Noto Sans TC", Arial;
      color: var(--txt);
      background: radial-gradient(1200px 600px at 50% -20%, #8B0000 0%, var(--bg1) 35%, #1C0000 100%);
      overflow: hidden;
    }
    .wrap {
      height: 100%;
      display: grid;
      grid-template-rows: auto 1fr auto;
      padding: calc(12px + var(--safe-top)) 12px calc(12px + var(--safe-bottom));
      gap: 10px;
      max-width: 980px;
      margin: 0 auto;
    }
    header { display: flex; align-items: center; justify-content: space-between; gap: 10px; }
    .brand {
      display: flex; flex-direction: column; gap: 2px;
      padding: 10px 12px;
      background: linear-gradient(180deg, var(--glass2), var(--glass));
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 14px;
      box-shadow: 0 8px 20px var(--shadow);
      min-width: 240px;
    }
    .brand .title { font-weight: 760; letter-spacing: .2px; display: flex; align-items: center; gap: 8px; }
    .brand .sub { font-size: 12px; color: var(--muted); }
    .pillbar { display: flex; gap: 8px; flex-wrap: wrap; justify-content: flex-end; }
    .pill {
      user-select: none;
      display: flex; align-items: center; gap: 8px;
      padding: 10px 12px;
      background: linear-gradient(180deg, var(--glass2), var(--glass));
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 999px;
      box-shadow: 0 8px 20px var(--shadow);
      font-size: 13px;
      color: var(--muted);
      white-space: nowrap;
    }
    .pill b { color: var(--txt); font-weight: 800; }
    main {
      position: relative;
      border-radius: 18px;
      overflow: hidden;
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: 0 18px 45px rgba(0,0,0,.45);
      min-height: 360px;
    }
    canvas { width: 100%; height: 100%; display: block; }
    footer {
      display: flex; align-items: center; justify-content: space-between; gap: 10px; flex-wrap: wrap;
      padding: 10px 12px;
      background: linear-gradient(180deg, var(--glass2), var(--glass));
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 14px;
      box-shadow: 0 8px 20px var(--shadow);
    }
    .btnrow { display: flex; gap: 10px; flex-wrap: wrap; }
    button {
      cursor: pointer;
      border: 1px solid rgba(255,255,255,.14);
      background: linear-gradient(180deg, rgba(255,255,255,.16), rgba(255,255,255,.08));
      color: var(--txt);
      padding: 10px 12px;
      border-radius: 12px;
      font-weight: 720;
      letter-spacing: .2px;
      box-shadow: 0 10px 25px rgba(0,0,0,.25);
      user-select: none;
    }
    button:active { transform: translateY(1px); }
    .ghost { background: transparent; }
    .accent { border-color: rgba(255,209,102,.45); }
    .accent span { color: var(--accent); }
    .hint { color: var(--muted); font-size: 13px; line-height: 1.35; }
    .hint code { color: var(--txt); background: rgba(255,255,255,.08); padding: 2px 6px; border-radius: 8px; }
    .overlay {
      position: absolute; inset: 0;
      display: flex; align-items: center; justify-content: center;
      padding: 18px;
      background: radial-gradient(900px 500px at 50% 0%, rgba(255,209,102,.10) 0%, rgba(0,0,0,.55) 60%, rgba(0,0,0,.66) 100%);
      backdrop-filter: blur(6px);
    }
    .card {
      width: min(560px, 100%);
      background: linear-gradient(180deg, rgba(255,255,255,.16), rgba(255,255,255,.08));
      border: 1px solid rgba(255,255,255,.14);
      border-radius: 18px;
      box-shadow: 0 25px 70px rgba(0,0,0,.55);
      padding: 18px 16px;
      text-align: center;
    }
    .card h1 { margin: 0 0 8px; font-size: 22px; letter-spacing: .2px; }
    .card p { margin: 8px 0; color: var(--muted); }
    .grid2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 12px; }
    .stat {
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 14px;
      padding: 10px 12px;
    }
    .stat .k { font-size: 12px; color: var(--muted); }
    .stat .v { font-size: 18px; font-weight: 820; margin-top: 2px; }
    .signature {
      margin-top: 14px;
      padding-top: 12px;
      border-top: 1px dashed rgba(255,255,255,.18);
      color: rgba(255,255,255,.85);
      line-height: 1.45;
    }
    .signature .small { color: var(--muted); font-size: 12px; margin-top: 4px; }
    .row { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 14px; justify-content: center; }
    .badge {
      display: inline-flex; align-items: center; gap: 8px;
      padding: 8px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.09);
      border: 1px solid rgba(255,255,255,.10);
      color: var(--muted);
      font-size: 12px;
    }
    .toast {
      position: absolute;
      left: 50%;
      bottom: 16px;
      transform: translateX(-50%);
      background: rgba(0,0,0,.55);
      border: 1px solid rgba(255,255,255,.14);
      color: rgba(255,255,255,.92);
      padding: 10px 12px;
      border-radius: 999px;
      font-size: 13px;
      box-shadow: 0 18px 45px rgba(0,0,0,.45);
      opacity: 0;
      pointer-events: none;
      transition: opacity .18s ease, transform .18s ease;
    }
    .toast.show { opacity: 1; transform: translateX(-50%) translateY(-4px); }
    #introOverlay {
      background: radial-gradient(1000px 600px at 50% -10%, rgba(255,209,102,.16) 0%, rgba(0,0,0,.62) 62%, rgba(0,0,0,.72) 100%);
    }
    .introTitle { font-size: 26px; font-weight: 860; margin: 0 0 6px; letter-spacing: .3px; }
    .introSub { margin: 0; color: rgba(255,255,255,.78); line-height: 1.5; }
    .introSig {
      margin-top: 12px;
      color: rgba(255,255,255,.82);
      border-top: 1px dashed rgba(255,255,255,.18);
      padding-top: 10px;
    }
    .introSig .small { color: rgba(255,255,255,.66); font-size: 12px; margin-top: 4px; }
    .input-group { margin: 12px 0; text-align: left; }
    .input-group label { font-size: 14px; color: var(--muted); margin-bottom: 4px; display: block; }
    .input-group input, .input-group select {
      width: 100%; padding: 8px; border-radius: 8px; border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.08); color: var(--txt); font-size: 14px;
    }
    .leaderboard {
      margin: 12px 0; text-align: left; font-size: 14px;
    }
    .leaderboard .row { display: grid; grid-template-columns: 50px 100px 80px 50px 1fr; gap: 8px; padding: 8px; border-bottom: 1px solid rgba(255,255,255,.1); }
    .leaderboard .header { font-weight: bold; color: var(--accent); }
    @media (max-width: 560px) {
      .brand { min-width: 0; }
      .brand .title { font-size: 14px; }
      .pill { font-size: 12px; padding: 9px 10px; }
      footer { gap: 8px; }
      .hint { font-size: 12px; }
      .grid2 { grid-template-columns: 1fr; }
      .leaderboard .row { grid-template-columns: 40px 80px 60px 40px 1fr; font-size: 12px; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="title">ğŸ Fire Horse Golf Dash <span class="badge">2026</span></div>
        <div class="sub">æ“Šçƒå¾Œè¿½çƒï¼Œå·¦å³æ»‘/â†â†’ç§»å‹•ï¼Œè·³èºé–ƒé¿ï¼Œæ”¶é›†ç´…åŒ…åŠ åˆ†</div>
      </div>
      <div class="pillbar">
        <div class="pill">Score <b id="uiScore">0</b></div>
        <div class="pill">Combo <b id="uiCombo">x1</b></div>
        <div class="pill">Packets <b id="uiPackets">0</b></div>
        <div class="pill" id="uiSoundPill">Sound <b id="uiSound">ON</b></div>
      </div>
    </header>

    <main>
      <canvas id="c" aria-label="Fire Horse Golf game canvas"></canvas>
      <div class="toast" id="toast">å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ âœ…</div>

      <!-- Intro cinematic (2 seconds) -->
      <div class="overlay" id="introOverlay" style="display:none;">
        <div class="card" style="text-align:left;">
          <div class="introTitle">ğŸ 2026 ç«é¦¬å¹´å¿«æ¨‚</div>
          <p class="introSub">é¦¬åˆ°æˆåŠŸ<br>ä¸€ä»½å¯ç©çš„æ–°å¹´è³€å¡ã€‚æ“Šçƒå¾Œè¿½çƒï¼Œæ”¶é›†ç´…åŒ…ï¼</p>
          <div class="introSig">
            <div>â€” YourCompany</div>
            <div class="small">Swipe on phone / â† â†’ / Space on desktop</div>
          </div>
        </div>
      </div>

      <!-- Start overlay -->
      <div class="overlay" id="startOverlay">
        <div class="card">
          <h1>ğŸ æ–°å¹´å¿«æ¨‚</h1>
          <p>æ“Šçƒå¾Œæ§åˆ¶ç«é¦¬è¿½çƒï¼Œæ”¶é›†ç´…åŒ…åŠ åˆ†ï¼Œèº²é¿éšœç¤™ã€‚æ‰‹æ©Ÿæ»‘å‹•/é»æ“Šï¼Œé›»è…¦ç”¨ <code>â†</code><code>â†’</code><code>Space</code>ã€‚</p>
          <div class="input-group">
            <label>æ‚¨çš„å§“å</label>
            <input id="playerName" type="text" placeholder="è¼¸å…¥å§“å" required />
          </div>
          <div class="input-group">
            <label>æ–°å¹´ç¥ç¦</label>
            <select id="playerBlessing">
              <option value="é¦¬åˆ°æˆåŠŸï¼">é¦¬åˆ°æˆåŠŸï¼</option>
              <option value="ä¸€é¦¬ç•¶å…ˆï¼">ä¸€é¦¬ç•¶å…ˆï¼</option>
              <option value="ç«ç´…å¥½é‹ï¼">ç«ç´…å¥½é‹ï¼</option>
              <option value="äº‹æ¥­é¨°é£›ï¼">äº‹æ¥­é¨°é£›ï¼</option>
              <option value="æ–°å¹´å¤§å‰ï¼">æ–°å¹´å¤§å‰ï¼</option>
              <option value="custom">è‡ªè¨‚ç¥ç¦</option>
            </select>
            <input id="customBlessing" type="text" placeholder="è¼¸å…¥è‡ªè¨‚ç¥ç¦ï¼ˆæœ€å¤š20å­—ï¼‰" style="display:none;" maxlength="20" />
          </div>
          <div class="row">
            <button class="accent" id="btnStart"><span>â–¶</span> é–‹å§‹éŠæˆ²</button>
            <button class="ghost" id="btnToggleSoundStart">ğŸ”Š åˆ‡æ›éŸ³æ•ˆ</button>
          </div>
          <p class="hint">å°å½©è›‹ï¼šé€£çºŒæ”¶é›†ç´…åŒ…å¯æå‡ Comboï¼Œåˆ†æ•¸ç¿»å€ï¼</p>
        </div>
      </div>

      <!-- End overlay -->
      <div class="overlay" id="endOverlay" style="display:none;">
        <div class="card">
          <h1>ğŸ æ–°å¹´å¿«æ¨‚</h1>
          <p style="margin-top:-4px;color:rgba(255,255,255,.78);">é¦¬åˆ°æˆåŠŸ</p>
          <p>ä½ å®Œæˆäº†ç«é¦¬æ“Šé å¤§è³½ï¼</p>
          <div class="grid2">
            <div class="stat">
              <div class="k">Final Score</div>
              <div class="v" id="endScore">0</div>
            </div>
            <div class="stat">
              <div class="k">Best Combo</div>
              <div class="v" id="endCombo">x1</div>
            </div>
            <div class="stat">
              <div class="k">Hit Distance</div>
              <div class="v" id="endDistance">0</div>
            </div>
            <div class="stat">
              <div class="k">Red Packets</div>
              <div class="v" id="endPackets">0</div>
            </div>
          </div>
          <div class="signature">
            <div>â€” YourCompany</div>
            <div class="small">ç¥æ‚¨æ–°å¹´å¤§å‰ï¼Œäº‹æ¥­é¨°é£›ï¼</div>
          </div>
          <div class="row">
            <button class="accent" id="btnSubmitScore"><span>ğŸ†</span> æäº¤æˆç¸¾</button>
            <button class="ghost" id="btnRestart"><span>â†»</span> å†ç©ä¸€æ¬¡</button>
            <button class="ghost" id="btnShare">ğŸ“¤ åˆ†äº«åˆ†æ•¸</button>
            <button class="ghost" id="btnToggleSoundEnd">ğŸ”Š åˆ‡æ›éŸ³æ•ˆ</button>
          </div>
        </div>
      </div>

      <!-- Leaderboard overlay (Company E-Card) -->
      <div class="overlay" id="leaderboardOverlay" style="display:none;">
        <div class="card" style="background: linear-gradient(180deg, #FF4500, #FFD700);">
          <h1>YourCompany 2026 ç«é¦¬å¹´</h1>
          <p style="margin-top:-4px;color:rgba(255,255,255,.78);">é¦¬åˆ°æˆåŠŸ</p>
          <div class="leaderboard" id="leaderboardRows">
            <div class="row header">
              <span>åæ¬¡</span><span>å§“å</span><span>åˆ†æ•¸</span><span>Combo</span><span>ç¥ç¦</span>
            </div>
            <!-- Dynamically populated -->
          </div>
          <div class="signature">
            <div>ç¥æ‚¨æ–°å¹´å¤§å‰ï¼Œäº‹æ¥­é¨°é£›ï¼Œè²¡æºå»£é€²ï¼</div>
            <div class="small">â€” YourCompany</div>
          </div>
          <div class="row">
            <button class="accent" id="btnRestartFromLeaderboard"><span>â†»</span> å†ç©ä¸€æ¬¡</button>
            <button class="ghost" id="btnShareFromLeaderboard">ğŸ“¤ åˆ†äº«</button>
          </div>
        </div>
      </div>
    </main>

    <footer>
      <div class="hint">
        æ“ä½œï¼šæ‰‹æ©Ÿ<strong>æ»‘å‹•/é»æ“Š</strong>ï½œé›»è…¦ <code>â†</code><code>â†’</code><code>Space</code> ï½œå¯æŒ‰ <code>R</code> é‡é–‹<br>
        ç›®æ¨™ï¼šæ“Šçƒå¾Œè¿½çƒï¼Œæ”¶é›†ç´…åŒ…åŠ åˆ†ï¼Œæ’éšœç¤™æ‰£åˆ†æ¸›é€Ÿ
      </div>
      <div class="btnrow">
        <button id="btnPause" class="ghost">â¸ æš«åœ</button>
        <button id="btnReset" class="ghost">ğŸ§¹ é‡ç½®</button>
      </div>
    </footer>
  </div>

  <script type="module">
    // Firebase (replace with your config)
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_STORAGE_BUCKET",
      messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    // Import Firebase (CDN for standalone HTML)
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js';
    import { getFirestore, collection, addDoc, query, orderBy, limit, getDocs } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js';

    let db;
    try {
      const app = initializeApp(firebaseConfig);
      db = getFirestore(app);
    } catch (e) {
      console.warn('Firebase not configured, using localStorage', e);
    }

    const CONFIG = {
      gameDistance: 1000, // Distance to hole
      ballSpeedBase: 200,
      ballSpeedMax: 400,
      playerSpeed: 300,
      jumpSpeed: 400,
      gravity: 800,
      packetSpawn: 0.45,
      obstacleSpawn: 0.30,
      packetRadius: 15,
      obstacleRadius: 20,
      ballRadius: 10,
      playerRadius: 20,
      comboWindow: 1.5,
      comboMax: 5,
      scorePenalty: 100,
      speedPenalty: 0.3
    };

    const BRAND = {
      company: 'YourCompany',
      greeting: 'æ–°å¹´å¿«æ¨‚',
      blessing: 'é¦¬åˆ°æˆåŠŸ'
    };

    // Canvas
    const canvas = document.getElementById('c');
    const ctx = canvas.getContext('2d', { alpha: false });
    let W = 800, H = 450;

    function resize() {
      const rect = canvas.getBoundingClientRect();
      const dpr = Math.min(2, window.devicePixelRatio || 1);
      canvas.width = Math.floor(rect.width * dpr);
      canvas.height = Math.floor(rect.height * dpr);
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
      W = rect.width;
      H = rect.height;
    }

    const ro = new ResizeObserver(resize);
    ro.observe(canvas);
    window.addEventListener('orientationchange', () => setTimeout(resize, 120));
    window.addEventListener('resize', () => setTimeout(resize, 50));

    // UI
    const uiScore = document.getElementById('uiScore');
    const uiCombo = document.getElementById('uiCombo');
    const uiPackets = document.getElementById('uiPackets');
    const uiSound = document.getElementById('uiSound');
    const uiSoundPill = document.getElementById('uiSoundPill');

    const introOverlay = document.getElementById('introOverlay');
    const startOverlay = document.getElementById('startOverlay');
    const endOverlay = document.getElementById('endOverlay');
    const leaderboardOverlay = document.getElementById('leaderboardOverlay');
    const endScore = document.getElementById('endScore');
    const endCombo = document.getElementById('endCombo');
    const endDistance = document.getElementById('endDistance');
    const endPackets = document.getElementById('endPackets');
    const toast = document.getElementById('toast');

    const btnStart = document.getElementById('btnStart');
    const btnRestart = document.getElementById('btnRestart');
    const btnPause = document.getElementById('btnPause');
    const btnReset = document.getElementById('btnReset');
    const btnShare = document.getElementById('btnShare');
    const btnSubmitScore = document.getElementById('btnSubmitScore');
    const btnToggleSoundStart = document.getElementById('btnToggleSoundStart');
    const btnToggleSoundEnd = document.getElementById('btnToggleSoundEnd');
    const btnRestartFromLeaderboard = document.getElementById('btnRestartFromLeaderboard');
    const btnShareFromLeaderboard = document.getElementById('btnShareFromLeaderboard');

    const playerNameInput = document.getElementById('playerName');
    const playerBlessingSelect = document.getElementById('playerBlessing');
    const customBlessingInput = document.getElementById('customBlessing');

    // Audio
    let audioOn = true;
    let audioCtx = null;

    function ensureAudio() {
      if (!audioCtx) {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      }
      if (audioCtx.state === 'suspended') audioCtx.resume().catch(() => {});
    }

    function beep(type = 'good') {
      if (!audioOn) return;
      ensureAudio();
      const t = audioCtx.currentTime;
      const o = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      o.type = 'sine';
      const base = (type === 'good') ? 660 : 220;
      o.frequency.setValueAtTime(base, t);
      o.frequency.exponentialRampToValueAtTime(base * (type === 'good' ? 1.25 : 0.8), t + 0.08);
 Ğ ĞµÑĞ¿

System: The code was cut off due to length constraints. Below, Iâ€™ll complete the remaining JavaScript portion and ensure the full `index.html` is cohesive, incorporating all requested features: gameplay (hit-and-run golf dash), Firebase leaderboard, blessing input, and company e-card styling. Iâ€™ll also address potential issues and provide a streamlined version to fit within a single HTML file deployable on GitHub Pages.

### Completion of JavaScript Section
The following continues from where the code was truncated, completing the audio functions, game logic, input handling, leaderboard integration, and rendering for the **Fire Horse Golf Dash**. Iâ€™ve optimized it to maintain the **Christmas Dash** structure while implementing your hit-and-run mechanic, Firebase leaderboard, and red-gold e-card aesthetic.

### Full `index.html` (Complete Version)
```html
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#3B0000" />
  <title>ğŸ Fire Horse Golf Dash 2026</title>
  <style>
    :root {
      --bg1: #3B0000;
      --glass: rgba(255,255,255,.08);
      --glass2: rgba(255,255,255,.12);
      --txt: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.70);
      --accent: #FFD700;
      --shadow: rgba(0,0,0,.35);
      --safe-top: env(safe-area-inset-top);
      --safe-bottom: env(safe-area-inset-bottom);
    }
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    html, body {
      height: 100%; margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, "PingFang TC","Noto Sans TC", Arial;
      color: var(--txt);
      background: radial-gradient(1200px 600px at 50% -20%, #8B0000 0%, var(--bg1) 35%, #1C0000 100%);
      overflow: hidden;
    }
    .wrap {
      height: 100%;
      display: grid;
      grid-template-rows: auto 1fr auto;
      padding: calc(12px + var(--safe-top)) 12px calc(12px + var(--safe-bottom));
      gap: 10px;
      max-width: 980px;
      margin: 0 auto;
    }
    header { display: flex; align-items: center; justify-content: space-between; gap: 10px; }
    .brand {
      display: flex; flex-direction: column; gap: 2px;
      padding: 10px 12px;
      background: linear-gradient(180deg, var(--glass2), var(--glass));
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 14px;
      box-shadow: 0 8px 20px var(--shadow);
      min-width: 240px;
    }
    .brand .title { font-weight: 760; letter-spacing: .2px; display: flex; align-items: center; gap: 8px; }
    .brand .sub { font-size: 12px; color: var(--muted); }
    .pillbar { display: flex; gap: 8px; flex-wrap: wrap; justify-content: flex-end; }
    .pill {
      user-select: none;
      display: flex; align-items: center; gap: 8px;
      padding: 10px 12px;
      background: linear-gradient(180deg, var(--glass2), var(--glass));
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 999px;
      box-shadow: 0 8px 20px var(--shadow);
      font-size: 13px;
      color: var(--muted);
      white-space: nowrap;
    }
    .pill b { color: var(--txt); font-weight: 800; }
    main {
      position: relative;
      border-radius: 18px;
      overflow: hidden;
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: 0 18px 45px rgba(0,0,0,.45);
      min-height: 360px;
    }
    canvas { width: 100%; height: 100%; display: block; }
    footer {
      display: flex; align-items: center; justify-content: space-between; gap: 10px; flex-wrap: wrap;
      padding: 10px 12px;
      background: linear-gradient(180deg, var(--glass2), var(--glass));
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 14px;
      box-shadow: 0 8px 20px var(--shadow);
    }
    .btnrow { display: flex; gap: 10px; flex-wrap: wrap; }
    button {
      cursor: pointer;
      border: 1px solid rgba(255,255,255,.14);
      background: linear-gradient(180deg, rgba(255,255,255,.16), rgba(255,255,255,.08));
      color: var(--txt);
      padding: 10px 12px;
      border-radius: 12px;
      font-weight: 720;
      letter-spacing: .2px;
      box-shadow: 0 10px 25px rgba(0,0,0,.25);
      user-select: none;
    }
    button:active { transform: translateY(1px); }
    .ghost { background: transparent; }
    .accent { border-color: rgba(255,209,102,.45); }
    .accent span { color: var(--accent); }
    .hint { color: var(--muted); font-size: 13px; line-height: 1.35; }
    .hint code { color: var(--txt); background: rgba(255,255,255,.08); padding: 2px 6px; border-radius: 8px; }
    .overlay {
      position: absolute; inset: 0;
      display: flex; align-items: center; justify-content: center;
      padding: 18px;
      background: radial-gradient(900px 500px at 50% 0%, rgba(255,209,102,.10) 0%, rgba(0,0,0,.55) 60%, rgba(0,0,0,.66) 100%);
      backdrop-filter: blur(6px);
    }
    .card {
      width: min(560px, 100%);
      background: linear-gradient(180deg, rgba(255,255,255,.16), rgba(255,255,255,.08));
      border: 1px solid rgba(255,255,255,.14);
      border-radius: 18px;
      box-shadow: 0 25px 70px rgba(0,0,0,.55);
      padding: 18px 16px;
      text-align: center;
    }
    .card h1 { margin: 0 0 8px; font-size: 22px; letter-spacing: .2px; }
    .card p { margin: 8px 0; color: var(--muted); }
    .grid2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 12px; }
    .stat {
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 14px;
      padding: 10px 12px;
    }
    .stat .k { font-size: 12px; color: var(--muted); }
    .stat .v { font-size: 18px; font-weight: 820; margin-top: 2px; }
    .signature {
      margin-top: 14px;
      padding-top: 12px;
      border-top: 1px dashed rgba(255,255,255,.18);
      color: rgba(255,255,255,.85);
      line-height: 1.45;
    }
    .signature .small { color: var(--muted); font-size: 12px; margin-top: 4px; }
    .row { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 14px; justify-content: center; }
    .badge {
      display: inline-flex; align-items: center; gap: 8px;
      padding: 8px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.09);
      border: 1px solid rgba(255,255,255,.10);
      color: var(--muted);
      font-size: 12px;
    }
    .toast {
      position: absolute;
      left: 50%;
      bottom: 16px;
      transform: translateX(-50%);
      background: rgba(0,0,0,.55);
      border: 1px solid rgba(255,255,255,.14);
      color: rgba(255,255,255,.92);
      padding: 10px 12px;
      border-radius: 999px;
      font-size: 13px;
      box-shadow: 0 18px 45px rgba(0,0,0,.45);
      opacity: 0;
      pointer-events: none;
      transition: opacity .18s ease, transform .18s ease;
    }
    .toast.show { opacity: 1; transform: translateX(-50%) translateY(-4px); }
    #introOverlay {
      background: radial-gradient(1000px 600px at 50% -10%, rgba(255,209,102,.16) 0%, rgba(0,0,0,.62) 62%, rgba(0,0,0,.72) 100%);
    }
    .introTitle { font-size: 26px; font-weight: 860; margin: 0 0 6px; letter-spacing: .3px; }
    .introSub { margin: 0; color: rgba(255,255,255,.78); line-height: 1.5; }
    .introSig {
      margin-top: 12px;
      color: rgba(255,255,255,.82);
      border-top: 1px dashed rgba(255,255,255,.18);
      padding-top: 10px;
    }
    .introSig .small { color: rgba(255,255,255,.66); font-size: 12px; margin-top: 4px; }
    .input-group { margin: 12px 0; text-align: left; }
    .input-group label { font-size: 14px; color: var(--muted); margin-bottom: 4px; display: block; }
    .input-group input, .input-group select {
      width: 100%; padding: 8px; border-radius: 8px; border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255 Covid-19,.08); color: var(--txt); font-size: 14px;
    }
    .leaderboard {
      margin: 12px 0; text-align: left; font-size: 14px;
    }
    .leaderboard .row { display: grid; grid-template-columns: 50px 100px 80px 50px 1fr; gap: 8px; padding: 8px; border-bottom: 1px solid rgba(255,255,255,.1); }
    .leaderboard .header { font-weight: bold; color: var(--accent); }
    @media (max-width: 560px) {
      .brand { min-width: 0; }
      .brand .title { font-size: 14px; }
      .pill { font-size: 12px; padding: 9px 10px; }
      footer { gap: 8px; }
      .hint { font-size: 12px; }
      .grid2 { grid-template-columns: 1fr; }
      .leaderboard .row { grid-template-columns: 40px 80px 60px 40px 1fr; font-size: 12px; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="title">ğŸ Fire Horse Golf Dash <span class="badge">2026</span></div>
        <div class="sub">æ“Šçƒå¾Œè¿½çƒï¼Œå·¦å³æ»‘/â†â†’ç§»å‹•ï¼Œè·³èºé–ƒé¿ï¼Œæ”¶é›†ç´…åŒ…åŠ åˆ†</div>
      </div>
      <div class="pillbar">
        <div class="pill">Score <b id="uiScore">0</b></div>
        <div class="pill">Combo <b id="uiCombo">x1</b></div>
        <div class="pill">Packets <b id="uiPackets">0</b></div>
        <div class="pill" id="uiSoundPill">Sound <b id="uiSound">ON</b></div>
      </div>
    </header>

    <main>
      <canvas id="c" aria-label="Fire Horse Golf game canvas"></canvas>
      <div class="toast" id="toast">å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ âœ…</div>

      <!-- Intro cinematic (2 seconds) -->
      <div class="overlay" id="introOverlay" style="display:none;">
        <div class="card" style="text-align:left;">
          <div class="introTitle">ğŸ 2026 ç«é¦¬å¹´å¿«æ¨‚</div>
          <p class="introSub">é¦¬åˆ°æˆåŠŸ<br>ä¸€ä»½å¯ç©çš„æ–°å¹´è³€å¡ã€‚æ“Šçƒå¾Œè¿½çƒï¼Œæ”¶é›†ç´…åŒ…ï¼</p>
          <div class="introSig">
            <div>â€” YourCompany</div>
            <div class="small">Swipe on phone / â† â†’ / Space on desktop</div>
          </div>
        </div>
      </div>

      <!-- Start overlay -->
      <div class="overlay" id="startOverlay">
        <div class="card">
          <h1>ğŸ æ–°å¹´å¿«æ¨‚</h1>
          <p>æ“Šçƒå¾Œæ§åˆ¶ç«é¦¬è¿½çƒï¼Œæ”¶é›†ç´…åŒ…åŠ åˆ†ï¼Œèº²é¿éšœç¤™ã€‚æ‰‹æ©Ÿæ»‘å‹•/é»æ“Šï¼Œé›»è…¦ç”¨ <code>â†</code><code>â†’</code><code>Space</code>ã€‚</p>
          <div class="input-group">
            <label>æ‚¨çš„å§“å</label>
            <input id="playerName" type="text" placeholder="è¼¸å…¥å§“å" required />
          </div>
          <div class="input-group">
            <label>æ–°å¹´ç¥ç¦</label>
            <select id="playerBlessing">
              <option value="é¦¬åˆ°æˆåŠŸï¼">é¦¬åˆ°æˆåŠŸï¼</option>
              <option value="ä¸€é¦¬ç•¶å…ˆï¼">ä¸€é¦¬ç•¶å…ˆï¼</option>
              <option value="ç«ç´…å¥½é‹ï¼">ç«ç´…å¥½é‹ï¼</option>
              <option value="äº‹æ¥­é¨°é£›ï¼">äº‹æ¥­é¨°é£›ï¼</option>
              <option value="æ–°å¹´å¤§å‰ï¼">æ–°å¹´å¤§å‰ï¼</option>
              <option value="custom">è‡ªè¨‚ç¥ç¦</option>
            </select>
            <input id="customBlessing" type="text" placeholder="è¼¸å…¥è‡ªè¨‚ç¥ç¦ï¼ˆæœ€å¤š20å­—ï¼‰" style="display:none;" maxlength="20" />
          </div>
          <div class="row">
            <button class="accent" id="btnStart"><span>â–¶</span> é–‹å§‹éŠæˆ²</button>
            <button class="ghost" id="btnToggleSoundStart">ğŸ”Š åˆ‡æ›éŸ³æ•ˆ</button>
          </div>
          <p class="hint">å°å½©è›‹ï¼šé€£çºŒæ”¶é›†ç´…åŒ…å¯æå‡ Comboï¼Œåˆ†æ•¸ç¿»å€ï¼</p>
        </div>
      </div>

      <!-- End overlay -->
      <div class="overlay" id="endOverlay" style="display:none;">
        <div class="card">
          <h1>ğŸ æ–°å¹´å¿«æ¨‚</h1>
          <p style="margin-top:-4px;color:rgba(255,255,255,.78);">é¦¬åˆ°æˆåŠŸ</p>
          <p>ä½ å®Œæˆäº†ç«é¦¬æ“Šé å¤§è³½ï¼</p>
          <div class="grid2">
            <div class="stat">
              <div class="k">Final Score</div>
              <div class="v" id="endScore">0</div>
            </div>
            <div class="stat">
              <div class="k">Best Combo</div>
              <div class="v" id="endCombo">x1</div>
            </div>
            <div class="stat">
              <div class="k">Hit Distance</div>
              <div class="v" id="endDistance">0</div>
            </div>
            <div class="stat">
              <div class="k">Red Packets</div>
              <div class="v" id="endPackets">0</div>
            </div>
          </div>
          <div class="signature">
            <div>â€” YourCompany</div>
            <div class="small">ç¥æ‚¨æ–°å¹´å¤§å‰ï¼Œäº‹æ¥­é¨°é£›ï¼</div>
          </div>
          <div class="row">
            <button class="accent" id="btnSubmitScore"><span>ğŸ†</span> æäº¤æˆç¸¾</button>
            <button class="ghost" id="btnRestart"><span>â†»</span> å†ç©ä¸€æ¬¡</button>
            <button class="ghost" id="btnShare">ğŸ“¤ åˆ†äº«åˆ†æ•¸</button>
            <button class="ghost" id="btnToggleSoundEnd">ğŸ”Š åˆ‡æ›éŸ³æ•ˆ</button>
          </div>
        </div>
      </div>

      <!-- Leaderboard overlay (Company E-Card) -->
      <div class="overlay" id="leaderboardOverlay" style="display:none;">
        <div class="card" style="background: linear-gradient(180deg, #FF4500, #FFD700);">
          <h1>YourCompany 2026 ç«é¦¬å¹´</h1>
          <p style="margin-top:-4px;color:rgba(255,255,255,.78);">é¦¬åˆ°æˆåŠŸ</p>
          <div class="leaderboard" id="leaderboardRows">
            <div class="row header">
              <span>åæ¬¡</span><span>å§“å</span><span>åˆ†æ•¸</span><span>Combo</span><span>ç¥ç¦</span>
            </div>
            <!-- Dynamically populated -->
          </div>
          <div class="signature">
            <div>ç¥æ‚¨æ–°å¹´å¤§å‰ï¼Œäº‹æ¥­é¨°é£›ï¼Œè²¡æºå»£é€²ï¼</div>
            <div class="small">â€” YourCompany</div>
          </div>
          <div class="row">
            <button class="accent" id="btnRestartFromLeaderboard"><span>â†»</span> å†ç©ä¸€æ¬¡</button>
            <button class="ghost" id="btnShareFromLeaderboard">ğŸ“¤ åˆ†äº«</button>
          </div>
        </div>
      </div>
    </main>

    <footer>
      <div class="hint">
        æ“ä½œï¼šæ‰‹æ©Ÿ<strong>æ»‘å‹•/é»æ“Š</strong>ï½œé›»è…¦ <code>â†</code><code>â†’</code><code>Space</code> ï½œå¯æŒ‰ <code>R</code> é‡é–‹<br>
        ç›®æ¨™ï¼šæ“Šçƒå¾Œè¿½çƒï¼Œæ”¶é›†ç´…åŒ…åŠ åˆ†ï¼Œæ’éšœç¤™æ‰£åˆ†æ¸›é€Ÿ
      </div>
      <div class="btnrow">
        <button id="btnPause" class="ghost">â¸ æš«åœ</button>
        <button id="btnReset" class="ghost">ğŸ§¹ é‡ç½®</button>
      </div>
    </footer>
  </div>

  <script type="module">
    // Firebase (replace with your config from Firebase Console)
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_AUTH_DOMAIN",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_STORAGE_BUCKET",
      messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    // Import Firebase
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js';
    import { getFirestore, collection, addDoc, query, orderBy, limit, getDocs } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js';

    let db;
    try {
      const app = initializeApp(firebaseConfig);
      db = getFirestore(app);
    } catch (e) {
      console.warn('Firebase not configured, using localStorage', e);
    }

    const CONFIG = {
      gameDistance: 1000, // Distance to hole
      ballSpeedBase: 200,
      ballSpeedMax: 400,
      playerSpeed: 300,
      jumpSpeed: 400,
      gravity: 800,
      packetSpawn: 0.45,
      obstacleSpawn: 0.30,
      packetRadius flaky: 15,
      obstacleRadius: 20,
      ballRadius: 10,
      playerRadius: 20,
      comboWindow: 1.5,
      comboMax: 5,
      scorePenalty: 100,
      speedPenalty: 0.3
    };

    const BRAND = {
      company: 'YourCompany',
      greeting: 'æ–°å¹´å¿«æ¨‚',
      blessing: 'é¦¬åˆ°æˆåŠŸ'
    };

    // Canvas
    const canvas = document.getElementById('c');
    const ctx = canvas.getContext('2d', { alpha: false });
    let W = 800, H = 450;

    function resize() {
      const rect = canvas.getBoundingClientRect();
      const dpr = Math.min(
      2, window.devicePixelRatio || 1);
      canvas.width = Math.floor(rect.width * dpr);
      canvas.height = Math.floor(rect.height * dpr);
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
      W = rect.width;
      H = rect.height;
    }

    const ro = new ResizeObserver(resize);
    ro.observe(canvas);
    window.addEventListener('orientationchange', () => setTimeout(resize, 120));
    window.addEventListener('resize', () => setTimeout(resize, 50));

    // UI Elements
    const uiScore = document.getElementById('uiScore');
    const uiCombo = document.getElementById('uiCombo');
    const uiPackets = document.getElementById('uiPackets');
    const uiSound = document.getElementById('uiSound');
    const uiSoundPill = document.getElementById('uiSoundPill');

    const introOverlay = document.getElementById('introOverlay');
    const startOverlay = document.getElementById('startOverlay');
    const endOverlay = document.getElementById('endOverlay');
    const leaderboardOverlay = document.getElementById('leaderboardOverlay');
    const endScore = document.getElementById('endScore');
    const endCombo = document.getElementById('endCombo');
    const endDistance = document.getElementById('endDistance');
    const endPackets = document.getElementById('endPackets');
    const toast = document.getElementById('toast');

    const btnStart = document.getElementById('btnStart');
    const btnRestart = document.getElementById('btnRestart');
    const btnPause = document.getElementById('btnPause');
    const btnReset = document.getElementById('btnReset');
    const btnShare = document.getElementById('btnShare');
    const btnSubmitScore = document.getElementById('btnSubmitScore');
    const btnToggleSoundStart = document.getElementById('btnToggleSoundStart');
    const btnToggleSoundEnd = document.getElementById('btnToggleSoundEnd');
    const btnRestartFromLeaderboard = document.getElementById('btnRestartFromLeaderboard');
    const btnShareFromLeaderboard = document.getElementById('btnShareFromLeaderboard');

    const playerNameInput = document.getElementById('playerName');
    const playerBlessingSelect = document.getElementById('playerBlessing');
    const customBlessingInput = document.getElementById('customBlessing');

    // Audio
    let audioOn = true;
    let audioCtx = null;

    function ensureAudio() {
      if (!audioCtx) {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      }
      if (audioCtx.state === 'suspended') audioCtx.resume().catch(() => {});
    }

    function beep(type = 'good') {
      if (!audioOn) return;
      ensureAudio();
      const t = audioCtx.currentTime;
      const o = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      o.type = 'sine';
      const base = (type === 'good') ? 660 : 220;
      o.frequency.setValueAtTime(base, t);
      o.frequency.exponentialRampToValueAtTime(base * (type === 'good' ? 1.25 : 0.8), t + 0.08);
      g.gain.setValueAtTime(0.0001, t);
      g.gain.exponentialRampToValueAtTime(0.08, t + 0.01);
      g.gain.exponentialRampToValueAtTime(0.0001, t + 0.12);
      o.connect(g).connect(audioCtx.destination);
      o.start(t);
      o.stop(t + 0.13);
    }

    function toggleSound() {
      audioOn = !audioOn;
      uiSound.textContent = audioOn ? 'ON' : 'OFF';
      uiSoundPill.style.opacity = audioOn ? '1' : '.75';
      beep('good');
    }

    // Game State
    let running = false;
    let paused = false;
    let hitBall = false;
    let score = 0;
    let combo = 1;
    let bestCombo = 1;
    let packets = 0;
    let hitDistance = 0;
    let lastPacketAt = -999;
    let playerName = '';
    let playerBlessing = '';

    const ball = { x: 0, y: 0, vx: 0, vy: 0, distance: 0 };
    const player = { x: 0, y: 0, vx: 0, vy: 0, jumping: false };
    let packetsList = [];
    let obstacles = [];
    let particles = [];

    // Input
    let keyL = false, keyR = false, keyJump = false;
    let touchActive = false;
    let touchX = 0;
    let touchStartX = 0, touchStartY = 0;

    // Helpers
    function rand(a, b) { return a + Math.random() * (b - a); }
    function clamp(v, a, b) { return Math.max(a, Math.min(b, v)); }

    function showToast(msg) {
      toast.textContent = msg;
      toast.classList.add('show');
      clearTimeout(showToast._t);
      showToast._t = setTimeout(() => toast.classList.remove('show'), 1400);
    }

    function updateUI() {
      uiScore.textContent = Math.floor(score);
      uiCombo.textContent = 'x' + combo;
      uiPackets.textContent = packets;
      uiSound.textContent = audioOn ? 'ON' : 'OFF';
      btnPause.textContent = paused ? 'â–¶ ç¹¼çºŒ' : 'â¸ æš«åœ';
    }

    function resetGame() {
      running = false;
      paused = false;
      hitBall = false;
      score = 0;
      combo = 1;
      bestCombo = 1;
      packets = 0;
      hitDistance = 0;
      lastPacketAt = -999;
      packetsList = [];
      obstacles = [];
      particles = [];

      ball.x = W / 4;
      ball.y = H - 50;
      ball.vx = 0;
      ball.vy = 0;
      ball.distance = 0;

      player.x = W / 4;
      player.y = H - 50;
      player.vx = 0;
      player.vy = 0;
      player.jumping = false;

      for (let i = 0; i < Math.floor((W * H) / 22000); i++) {
        particles.push({ x: rand(0, W), y: rand(0, H), r: rand(0.6, 2.2), vx: rand(-10, 10), vy: rand(20, 60) });
      }

      updateUI();
      draw();
    }

    function startGame() {
      playerName = playerNameInput.value.trim() || 'ç¥ç§˜çƒæ‰‹';
      playerBlessing = playerBlessingSelect.value === 'custom' ? customBlessingInput.value.trim() || 'æ–°å¹´å¿«æ¨‚ï¼' : playerBlessingSelect.value;
      running = true;
      paused = false;
      startOverlay.style.display = 'none';
      endOverlay.style.display = 'none';
      leaderboardOverlay.style.display = 'none';
      lastTs = performance.now();
      requestAnimationFrame(loop);
    }

    function endGame() {
      running = false;
      paused = false;
      endScore.textContent = Math.floor(score);
      endCombo.textContent = 'x' + bestCombo;
      endDistance.textContent = Math.floor(hitDistance);
      endPackets.textContent = packets;
      endOverlay.style.display = 'flex';
    }

    async function submitScore() {
      const entry = { name: playerName, score: Math.floor(score), combo: bestCombo, blessing: playerBlessing, timestamp: new Date() };
      if (db) {
        try {
          await addDoc(collection(db, 'leaderboard'), entry);
        } catch (e) {
          console.error('Failed to submit score', e);
        }
      } else {
        let localLeaderboard = JSON.parse(localStorage.getItem('leaderboard') || '[]');
        localLeaderboard.push(entry);
        localLeaderboard.sort((a, b) => b.score - a.score);
        localLeaderboard = localLeaderboard.slice(0, 10);
        localStorage.setItem('leaderboard', JSON.stringify(localLeaderboard));
      }
      showLeaderboard();
    }

    async function showLeaderboard() {
      endOverlay.style.display = 'none';
      leaderboardOverlay.style.display = 'flex';
      const leaderboardRows = document.getElementById('leaderboardRows');
      leaderboardRows.innerHTML = '<div class="row header"><span>åæ¬¡</span><span>å§“å</span><span>åˆ†æ•¸</span><span>Combo</span><span>ç¥ç¦</span></div>';

      let entries = [];
      if (db) {
        try {
          const q = query(collection(db, 'leaderboard'), orderBy('score', 'desc'), limit(10));
          const snapshot = await getDocs(q);
          snapshot.forEach(doc => entries.push(doc.data()));
        } catch (e) {
          console.error('Failed to fetch leaderboard', e);
        }
      } else {
        entries = JSON.parse(localStorage.getItem('leaderboard') || '[]');
      }

      entries.forEach((entry, i) => {
        const row = document.createElement('div');
        row.className = 'row';
        row.innerHTML = `<span>#${i + 1}</span><span>${entry.name}</span><span>${entry.score}</span><span>x${entry.combo}</span><span>${entry.blessing}</span>`;
        leaderboardRows.appendChild(row);
      });
    }

    function spawn(dt) {
      const packetChance = 1 - Math.exp(-CONFIG.packetSpawn * dt);
      const obstacleChance = 1 - Math.exp(-CONFIG.obstacleSpawn * dt);

      if (Math.random() < packetChance) {
        packetsList.push({
          x: ball.distance + W,
          y: rand(H * 0.2, H * 0.8),
          r: CONFIG.packetRadius,
          type: Math.random() < 0.7 ? 'red' : 'gold'
        });
      }
      if (Math.random() < obstacleChance) {
        obstacles.push({
          x: ball.distance + W,
          y: rand(H * 0.2, H * 0.8),
          r: CONFIG.obstacleRadius,
          type: Math.random() < 0.5 ? 'firecracker' : 'lion'
        });
      }
    }

    function collide(a, b) {
      const dx = a.x - b.x;
      const dy = a.y - b.y;
      const rr = a.r + b.r;
      return (dx * dx + dy * dy) <= rr * rr;
    }

    function applyCombo(now) {
      if (now - lastPacketAt <= CONFIG.comboWindow) {
        combo = Math.min(CONFIG.comboMax, combo + 1);
      } else {
        combo = 1;
      }
      bestCombo = Math.max(bestCombo, combo);
      lastPacketAt = now;
    }

    // Rendering
    function drawBackground() {
      const g = ctx.createLinearGradient(0, 0, 0, H);
      g.addColorStop(0, '#8B0000');
      g.addColorStop(0.55, '#3B0000');
      g.addColorStop(1, '#1C0000');
      ctx.fillStyle = g;
      ctx.fillRect(0, 0, W, H);

      ctx.globalAlpha = 0.15;
      ctx.beginPath();
      ctx.arc(W * 0.5, H * 0.05, Math.min(W, H) * 0.55, 0, Math.PI * 2);
      ctx.fillStyle = '#FFD700';
      ctx.fill();
      ctx.globalAlpha = 1;

      ctx.fillStyle = '#228B22';
      ctx.fillRect(0, H * 0.8, W, H * 0.2);

      const holeX = CONFIG.gameDistance - ball.distance + W / 2;
      ctx.fillStyle = '#000';
      ctx.beginPath();
      ctx.arc(holeX, H * 0.85, 20, 0, Math.PI * 2);
      ctx.fill();
    }

    function drawParticles(dt) {
      for (const p of particles) {
        p.y += p.vy * dt;
        p.x += p.vx * dt;
        if (p.y > H + 8) { p.y = -8; p.x = rand(0, W); }
      }
      ctx.fillStyle = 'rgba(255,255,255,0.75)';
      for (const p of particles) {
        ctx.globalAlpha = 0.35 + (p.r / 2.2) * 0.65;
        ctx.beginPath();
        ctx.arc(p.x - ball.distance + W / 2, p.y, p.r, 0, Math.PI * 2);
        ctx.fill();
      }
      ctx.globalAlpha = 1;
    }

    function drawBall() {
      const x = W / 2;
      const y = ball.y;
      ctx.save();
      ctx.translate(x, y);
      ctx.fillStyle = '#FF4500';
      ctx.beginPath();
      ctx.arc(0, 0, CONFIG.ballRadius, 0, Math.PI * 2);
      ctx.fill();
      ctx.fillStyle = 'rgba(255,215,0,0.3)';
      ctx.globalAlpha = 0.5;
      ctx.beginPath();
      ctx.arc(0, 0, CONFIG.ballRadius * 1.5, 0, Math.PI * 2);
      ctx.fill();
      ctx.restore();
    }

    function drawPlayer() {
      const x = player.x - ball.distance + W / 2;
      const y = player.y;
      ctx.save();
      ctx.translate(x, y);

      ctx.globalAlpha = 0.25;
      ctx.fillStyle = '#000';
      ctx.beginPath();
      ctx.ellipse(0, 22, 26, 10, 0, 0, Math.PI * 2);
      ctx.fill();
      ctx.globalAlpha = 1;

      ctx.fillStyle = '#FF4500';
      ctx.strokeStyle = 'rgba(255,255,255,0.35)';
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.roundRect(-15, -20, 30, 20, 5);
      ctx.fill();
      ctx.stroke();

      ctx.fillStyle = '#FFD700';
      ctx.beginPath();
      ctx.moveTo(0, -25);
      ctx.lineTo(5, -30);
      ctx.lineTo(-5, -30);
      ctx.fill();

      ctx.restore();
    }

    function drawPacket(p) {
      const x = p.x - ball.distance + W / 2;
      const y = p.y;
      ctx.save();
      ctx.translate(x, y);
      ctx.fillStyle = p.type === 'red' ? '#FF0000' : '#FFD700';
      ctx.beginPath();
      ctx.roundRect(-10, -10, 20, 20, 5);
      ctx.fill();
      ctx.restore();
    }

    function drawObstacle(o) {
      const x = o.x - ball.distance + W / 2;
      const y = o.y;
      ctx.save();
      ctx.translate(x, y);
      ctx.fillStyle = o.type === 'firecracker' ? '#FF4500' : '#FFD700';
      ctx.beginPath();
      ctx.arc(0, 0, CONFIG.obstacleRadius, 0, Math.PI * 2);
      ctx.fill();
      ctx.restore();
    }

    function drawHUDHint() {
      ctx.save();
      ctx.globalAlpha = 0.35;
      ctx.fillStyle = 'rgba(255,255,255,0.8)';
      ctx.font = '12px ui-sans-serif, system-ui';
      ctx.fillText(`${BRAND.greeting} Â· ${BRAND.blessing} â€” ${BRAND.company}`, 14, H - 14);
      ctx.restore();
    }

    function draw(dt = 0) {
      drawBackground();
      drawParticles(dt);
      for (const p of packetsList) drawPacket(p);
      for (const o of obstacles) drawObstacle(o);
      drawBall();
      drawPlayer();
      drawHUDHint();

      if (!hitBall) {
        ctx.save();
        ctx.globalAlpha = 0.8;
        ctx.fillStyle = 'rgba(255,255,255,0.9)';
        ctx.font = '16px ui-sans-serif, system-ui';
        ctx.fillText('æ‹–æ›³æˆ–é»æ“Šæ“Šçƒï¼', W / 2 - 60, H / 2);
        ctx.restore();
      }

      if (paused && running) {
        ctx.save();
        ctx.globalAlpha = 0.55;
        ctx.fillStyle = '#000';
        ctx.fillRect(0, 0, W, H);
        ctx.globalAlpha = 1;
        ctx.fillStyle = 'rgba(255,255,255,0.92)';
        ctx.font = '800 22px ui-sans-serif, system-ui';
        ctx.fillText('æš«åœä¸­', W / 2 - 38, H / 2 - 6);
        ctx.fillStyle = 'rgba(255,255,255,0.75)';
        ctx.font = '14px ui-sans-serif, system-ui';
        ctx.fillText('æŒ‰ã€Œæš«åœã€æˆ–ç©ºç™½éµç¹¼çºŒ', W / 2 - 92, H / 2 + 18);
        ctx.restore();
      }
    }

    // Game Loop
    let lastTs = 0;

    function loop(ts) {
      if (!running) return;
      const dt = Math.min(0.033, (ts - lastTs) / 1000);
      lastTs = ts;

      if (!paused) {
        if (!hitBall) {
          draw(dt);
          return;
        }

        ball.distance += ball.vx * dt;
        ball.vx = clamp(ball.vx * (1 - 0.2 * dt), 0, CONFIG.ballSpeedMax);
        ball.y += ball.vy * dt;
        ball.vy += CONFIG.gravity * dt;
        if (ball.y > H - 50) {
          ball.y = H - 50;
          ball.vy = 0;
        }

        player.x += player.vx * dt;
        if (player.jumping) {
          player.y += player.vy * dt;
          player.vy += CONFIG.gravity * dt;
          if (player.y >= H - 50) {
            player.y = H - 50;
            player.vy = 0;
            player.jumping = false;
          }
        }

        player.x = clamp(player.x, ball.distance - W / 4, ball.distance + W / 4);

        if (Math.abs(player.x - ball.distance) < 50 && !player.jumping) {
          ball.vx += player.vx * 0.1 * dt;
        }

        spawn(dt);

        for (let i = packetsList.length - 1; i >= 0; i--) {
          const p = packetsList[i];
          if (p.x < ball.distance - W / 2) {
            packetsList.splice(i, 1);
            continue;
          }
          if (collide({ x: player.x, y: player.y, r: CONFIG.playerRadius }, { x: p.x, y: p.y, r: p.r })) {
            packetsList.splice(i, 1);
            applyCombo(ts / 1000);
            const points = (p.type === 'red' ? 50 : 100) * combo;
            score += points;
            packets++;
            beep('good');
          }
        }

        for (let i = obstacles.length - 1; i >= 0; i--) {
          const o = obstacles[i];
          if (o.x < ball.distance - W / 2) {
            obstacles.splice(i, 1);
            continue;
          }
          if (collide({ x: ball.x, y: ball.y, r: CONFIG.ballRadius }, { x: o.x, y: o.y, r: o.r })) {
            obstacles.splice(i, 1);
            combo = 1;
            const penalty = o.type === 'firecracker' ? 100 : 200;
            score = Math.max(0, score - penalty);
            ball.vx *= (1 - CONFIG.speedPenalty);
            beep('bad');
          }
        }

        if (ts / 1000 - lastPacketAt > CONFIG.comboWindow) {
          combo = 1;
        }

        if (ball.distance >= CONFIG.gameDistance) {
          endGame();
          return;
        }

        updateUI();
        draw(dt);
      } else {
        draw(0);
      }

      requestAnimationFrame(loop);
    }

    // Input Handling
    window.addEventListener('keydown', (e) => {
      const k = e.key.toLowerCase();
      if (k === 'arrowleft') { keyL = true; e.preventDefault(); }
      if (k === 'arrowright') { keyR = true; e.preventDefault(); }
      if (k === ' ') { keyJump = true; e.preventDefault(); }
      if (k === 'r') { resetGame(); startOverlay.style.display = 'flex'; endOverlay.style.display = 'none'; leaderboardOverlay.style.display = 'none'; }
      if (k === 'm') { toggleSound(); }
    }, { passive: false });

    window.addEventListener('keyup', (e) => {
      const k = e.key.toLowerCase();
      if (k === 'arrowleft') keyL = false;
      if (k === 'arrowright') keyR = false;
      if (k === ' ') keyJump = false;
    });

    function onTouchStart(ev) {
      touchActive = true;
      const t = ev.touches ? ev.touches[0] : ev;
      const rect = canvas.getBoundingClientRect();
      touchStartX = touchX = (t.clientX - rect.left);
      touchStartY = (t.clientY - rect.top);
      if (audioOn) { try { ensureAudio(); } catch (_) {} }
    }

    function onTouchMove(ev) {
      const t = ev.touches ? ev.touches[0] : ev;
      const rect = canvas.getBoundingClientRect();
      touchX = (t.clientX - rect.left);
    }

    function onTouchEnd() {
      if (!hitBall) {
        const dx = touchStartX - touchX;
        const dy = touchStartY - (touchStartY > H / 2 ? touchStartY : H / 2);
        ball.vx = clamp(dx * 0.5, 50, CONFIG.ballSpeedMax);
        hitDistance = ball.vx * 2;
        score += hitDistance;
        hitBall = true;
      } else if (!player.jumping) {
        player.vy = -CONFIG.jumpSpeed;
        player.jumping = true;
      }
      touchActive = false;
    }

    canvas.addEventListener('touchstart', onTouchStart, { passive: true });
    canvas.addEventListener('touchmove', onTouchMove, { passive: true });
    canvas.addEventListener('touchend', onTouchEnd, { passive: true });
    canvas.addEventListener('mousedown', onTouchStart);
    window.addEventListener('mousemove', (e) => { if (touchActive) onTouchMove(e); });
    window.addEventListener('mouseup', onTouchEnd);

    // Buttons and Events
    btnStart.addEventListener('click', startGame);
    btnRestart.addEventListener('click', () => { resetGame(); startGame(); });
    btnPause.addEventListener('click', () => {
      if (!running) return;
      paused = !paused;
      updateUI();
      if (!paused && audioOn) { try { ensureAudio(); } catch (_) {} }
    });
    btnReset.addEventListener('click', () => {
      resetGame();
      startOverlay.style.display = 'flex';
      endOverlay.style.display = 'none';
      leaderboardOverlay.style.display = 'none';
    });
    btnToggleSoundStart.addEventListener('click', toggleSound);
    btnToggleSoundEnd.addEventListener('click', toggleSound);
    uiSoundPill.addEventListener('click', toggleSound);
    btnSubmitScore.addEventListener('click', submitScore);
    btnRestartFromLeaderboard.addEventListener('click', () => { resetGame(); startGame(); });

    async function shareScore() {
      const msg = `${BRAND.greeting} ğŸ\n${BRAND.blessing}\næˆ‘åœ¨ ${BRAND.company} ç«é¦¬æ“Šé å¤§è³½å¾—äº† ${Math.floor(score)} åˆ†ï¼ˆCombo x${bestCombo}ï¼‰ï¼\nç¥ç¦ï¼š${playerBlessing}\nå¿«ä¾†æŒ‘æˆ°ï¼${window.location.href}`;
      try {
        await navigator.clipboard.writeText(msg);
        showToast('å·²è¤‡è£½åˆ†äº«æ–‡å­— âœ…');
        beep('good');
      } catch (err) {
        window.prompt('è¤‡è£½é€™æ®µæ–‡å­—åˆ†äº«ï¼š',
